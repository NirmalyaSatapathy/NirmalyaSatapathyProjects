package com.java.asset.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import com.java.asset.model.Employ;
import com.java.asset.util.ConnectionHelper;

public class EmployDaoImpl implements EmployDao{
	Connection con;
	PreparedStatement pst;
	@Override
	public String addEmployDao(Employ employ) throws ClassNotFoundException, SQLException {
	    Connection con = ConnectionHelper.getConnection();
	    String empCmd = "INSERT INTO Employee (Username, PasswordHash, Department, Email, Type) VALUES (?, ?, ?, ?, ?)";
	    String adminCmd = "INSERT INTO Admin (Username, PasswordHash, Email) VALUES (?, ?, ?)";

	    try (
	        PreparedStatement empPstmt = con.prepareStatement(empCmd);
	        PreparedStatement adminPstmt = "admin".equalsIgnoreCase(employ.getType())
	                                        ? con.prepareStatement(adminCmd)
	                                        : null
	    ) {
	        // Insert into Employee
	        empPstmt.setString(1, employ.getUserName());
	        empPstmt.setString(2, employ.getPassword()); // Ideally hash this
	        empPstmt.setString(3, employ.getDept());
	        empPstmt.setString(4, employ.getEmail());
	        empPstmt.setString(5, employ.getType());
	        int empInserted = empPstmt.executeUpdate();

	        // If admin, insert into Admin table
	        if ("admin".equalsIgnoreCase(employ.getType()) && adminPstmt != null) {
	            adminPstmt.setString(1, employ.getUserName());
	            adminPstmt.setString(2, employ.getPassword()); // Same here: hash recommended
	            adminPstmt.setString(3, employ.getEmail());
	            adminPstmt.executeUpdate();
	        }

	        if (empInserted > 0) {
	            return "Employee added successfully" + 
	                   ("admin".equalsIgnoreCase(employ.getType()) ? " as Admin." : ".");
	        } else {
	            return "Failed to add employee.";
	        }
	    } catch (SQLException e) {
	        e.printStackTrace();
	        return "Error: " + e.getMessage();
	    } finally {
	        con.close();
	    }
	}

	


	@Override
	public String showEmployDao() {
		// TODO Auto-generated method stub
		return null;
	}

}
